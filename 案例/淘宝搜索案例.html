<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="../../jQuery/jquery.min.js"></script>
    <script src="../../AJAX/form表单及模板引擎/template-web.js"></script>
    <style>
        #suggest-list{
            border: 1px solid #ccc;
            display: none;

        }

        .suggest-item{
            line-height: 30px;
            padding-left: 5px;
        }

        .suggest-item:hover{
            cursor: pointer;
            background-color: #eee;
        }
    </style>
</head>
<body>
<!-- 搜索区域 -->
    <div class="search-box">
        <input type="text" class="ipt" name="" id="ipt">
        <button class="btnSearch">搜素</button>
    </div>
<!-- 搜索建议列表 -->
<div id="suggest-list">

</div>


<!-- 模板结构 -->
    <script id="tpl-suggestList" type="text/html">

        {{each result}}
        <!-- 搜索建议项 -->
        <div class="suggest-item">{{$value[0]}}</div>
        {{/each}}

    </script>


    <script>


        $(function(){

            // 1 定义延时器的ID
            var timer = null

            // 定义全局缓存对象
            var cacheObj = {}

            // 2 定义防抖的函数
            function decounceSearch(kw){
                timer = setTimeout(function(){
                    getSuggestList(kw)
                },500)
            }


            //           为输入框绑定keyup事件
            $('#ipt').on('keyup',function(){

                // 3 清空timer
                clearTimeout(timer)

                var keywords = $(this).val().trim()
                if(keywords.length <= 0){
                    return $('#suggest-list').empty().hide()
                }

                // 先判断缓存中是否有数据
                if(cacheObj[keywords]){
                    return rl(cacheObj[keywords])
                }

                // 获取搜索建议列表
                // console.log(keywords);
                getSuggestList(keywords)
                // debounceSearch(keywords)
            })


            function getSuggestList(kw){
                $.ajax({
                    url: 'https://suggest.taobao.com/sug?q=' + kw,
                    dataType: 'jsonp',
                    success: function(res){
                        console.log(res);
                        rl(res)
                    }
                })
            }


            // 渲染ui结构
            function rl(res){
                if(res.result.length <=0){
                    return $('#suggest-list').empty().hide()
                }
                var htmlStr = template('tpl-suggestList',res)
                $('#suggest-list').html(htmlStr).show()

                // 1 获取用户输入的内容, 当做键
                    var k = $('#ipt').val().trim()
                // 2 需要将数据作为值, 进行缓存
                    cacheObj[k] = res
            }
        })
    </script>
</body>
</html>